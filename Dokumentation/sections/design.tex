\chapter{Design og Implementering}
Systemmet Bargainbarter er designet ud fra de krav og analyser der er beskrevet i de ovenstående sektioner. Da web applikation er lavet i ASP.Net MVC beskrives i denne sektion de forskellige dele af MVC'en, hvor der beskrives: controllere, views og Modellen. 


\section{Controllere}
Der er en overordnet rollefordeling af controllernes ansvar: 

\input{sections/ControllerAnsvar.tex}

\section{Generel controller-funktionalitet}

Generelt er der anvendt forskellige standardmetoder igennem mange af controllerne. Til data acces kalder alle controllere igennem et Unit of Work pattern, som beskrives i sektion \ref{sc:RepositoryPattern}. Til at finde den aktuelle bruger i systemet bruges HttpContext hvor brugeren findes på ID. Controllerne holder selv styr på at kalde fejl hvis de bliver kaldt med ugyldige parametre.

\subsection{Eksemplificering af controller-funktionalitet}
Denne sektion omhandler funktionaliteten af en controller, og hvordan den fungerer. Dette er eksemplificeret igennem User storien: Opret en bytteannonce, og tager udgangspunkt i controllerens action til oprettelse af bytteannoncer.
Som det kan ses på figur \ref{fig:SDOpretAnnonceFuld} bliver actionen kaldt fra viewet. Viewet viser kun denne mulighed hvis brugeren er autentificeret, hvilket viewet, selv holder styr på. Når UI elementet bliver trykker, kalder det et Http request og serveren returnere et view til oprettelsen af BarterAds. Viewet indeholder en række forms hvor informationen om barterads kan indsættes. Denne gruppe af forms gives som parametre til aktionen når brugeren submitter. Under dette submit laver clienten et http POST til serveren, der kalder Create barterad aktionen. Actionen i controlleren læser billedet brugeren har uploadet ind i et bytearray, og laver et thumbnail ud fra billedet. Igennem Httpcontext findes den aktuelle bruger, og igennem Unit of Work, gemmes annoncen i databasen. Selve aktionen returnere et redirect til aktionen ManageAds i BarteradsControlleren. Det er væsentligt at bide mærke i at selve actionen tilhører i controlleren anvender ASP.NETs automatiske autherization, der gør at controlleren redirecter til login viewet, hvis der brugeren ikke er logget ind.


\begin{figure}[H]
	\centering
	\includegraphics
	[width=150mm]{figures/SDOpretAnnonceFuld.PDF}
	\caption{Sekvensdiagram for, hvordan barterAds bliver oprettet}
	\label{fig:SDOpretAnnonceFuld}
\end{figure}   

Denne beskrivelse er sigende for mange af de interaktioner der foregår på bargainbarter webstedet, da de essentielle aktions er kaldt igennem UI elementer der laver enten GET eller POST funktioner. Ligeledes anvendes kald ned i Unit of Work, i næsten al interaktion med serveren. 


\section{Modellen}

Den endelige model (med undtagelse af den genererede indentitymodel) kan ses på figur. \ref{Manglende }. Denne model genererer databasen, ved hjælp af det tidligere beskrevede EF. Modellen er lavet ud fra domæneanalysen og implementationen af modellen tilgås af controllerne til at hente data.

\section{Data fra Database}
\input{sections/subsection/UOFDB.tex}
